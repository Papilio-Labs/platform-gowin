; PlatformIO Project Configuration File
;
; Custom ESP32 Board with FPGA - Unified Platform Example
;
; This example demonstrates how to use a custom ESP32+FPGA board
; with the Gowin platform without needing additional code or platform references.
;
; For more information: https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = papilio_retrocade

; ==============================================================================
; Unified ESP32+FPGA Build using Gowin Platform
; ==============================================================================
; This environment demonstrates the new simplified approach where you can
; use platform = gowin with a combined board definition that includes both
; ESP32 and FPGA configurations.
[env:papilio_retrocade]
platform = gowin
board = papilio_retrocade
framework = arduino
build_type = debug

; ESP32-S3 memory and flash configuration
board_build.arduino.memory_type = qio_qspi
board_build.flash_mode = qio
board_build.psram_type = qio
board_upload.flash_size = 8MB
board_upload.maximum_size = 8388608
board_build.partitions = default.csv
board_build.filesystem = littlefs

; Build flags for ESP32
build_flags =
    -I include
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DBOARD_HAS_PSRAM
    -DFPGA_ENABLED=1
    -DESP32_S3=1
    ; SPI pins for FPGA communication
    -DFPGA_SPI_CLK=12
    -DFPGA_SPI_MISO=9
    -DFPGA_SPI_MOSI=11
    -DFPGA_SPI_CS=10
    ; Additional FPGA control pins
    -DFPGA_RESET_PIN=26

; FPGA-specific configuration
board_build.fpga_project = fpga/project.gprj
board_build.gowin_path = C:/Gowin/Gowin_V1.9.11.03_Education_x64

; Upload configuration
upload_protocol = esptool
upload_speed = 921600

; Serial monitor configuration
monitor_speed = 115200
monitor_filters =
    esp32_exception_decoder

; Library dependencies
lib_deps =
    fastled/FastLED@^3.9.4

; ==============================================================================
; Separate Environments (Optional - for testing individual targets)
; ==============================================================================

; ESP32-only build (no FPGA)
[env:esp32_only]
platform = gowin
board = papilio_retrocade
framework = arduino
build_type = debug

board_build.arduino.memory_type = qio_qspi
board_build.flash_mode = qio
board_build.psram_type = qio

build_flags =
    -I include
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DBOARD_HAS_PSRAM
    -DFPGA_ENABLED=0
    -DESP32_S3=1

upload_protocol = esptool
upload_speed = 921600
monitor_speed = 115200

lib_deps =
    fastled/FastLED@^3.9.4

; FPGA-only build
[env:fpga_only]
platform = gowin
board = papilio_retrocade
framework = hdl

board_build.fpga_project = fpga/project.gprj
board_build.gowin_path = C:/Gowin/Gowin_V1.9.11.03_Education_x64

upload_protocol = pesptool
